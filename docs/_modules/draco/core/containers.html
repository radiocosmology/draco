

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>draco.core.containers &mdash; draco 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            draco
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev.html">Development Guidelines</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">draco</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">draco.core.containers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for draco.core.containers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Distributed containers for holding various types of analysis data.</span>

<span class="sd">Containers</span>
<span class="sd">==========</span>
<span class="sd">- :py:class:`Map`</span>
<span class="sd">- :py:class:`SiderealStream`</span>
<span class="sd">- :py:class:`SystemSensitivity`</span>
<span class="sd">- :py:class:`RFIMask`</span>
<span class="sd">- :py:class:`TimeStream`</span>
<span class="sd">- :py:class:`GridBeam`</span>
<span class="sd">- :py:class:`TrackBeam`</span>
<span class="sd">- :py:class:`MModes`</span>
<span class="sd">- :py:class:`SVDModes`</span>
<span class="sd">- :py:class:`KLModes`</span>
<span class="sd">- :py:class:`VisGridStream`</span>
<span class="sd">- :py:class:`HybridVisStream`</span>
<span class="sd">- :py:class:`HybridVisMModes`</span>
<span class="sd">- :py:class:`RingMap`</span>
<span class="sd">- :py:class:`RingMapMask`</span>
<span class="sd">- :py:class:`RingMapTaper`</span>
<span class="sd">- :py:class:`CommonModeGainData`</span>
<span class="sd">- :py:class:`CommonModeSiderealGainData`</span>
<span class="sd">- :py:class:`GainData`</span>
<span class="sd">- :py:class:`SiderealGainData`</span>
<span class="sd">- :py:class:`StaticGainData`</span>
<span class="sd">- :py:class:`DelayCutoff`</span>
<span class="sd">- :py:class:`DelaySpectrum`</span>
<span class="sd">- :py:class:`Powerspectrum2D`</span>
<span class="sd">- :py:class:`SVDSpectrum`</span>
<span class="sd">- :py:class:`FrequencyStack`</span>
<span class="sd">- :py:class:`FrequencyStackByPol`</span>
<span class="sd">- :py:class:`MockFrequencyStack`</span>
<span class="sd">- :py:class:`MockFrequencyStackByPol`</span>
<span class="sd">- :py:class:`SourceCatalog`</span>
<span class="sd">- :py:class:`SpectroscopicCatalog`</span>
<span class="sd">- :py:class:`FormedBeam`</span>
<span class="sd">- :py:class:`FormedBeamHA`</span>
<span class="sd">- :py:class:`FormedBeamMask`</span>
<span class="sd">- :py:class:`FormedBeamHAMask`</span>
<span class="sd">- :py:class:`LocalizedRFIMask`</span>
<span class="sd">- :py:class:`LocalizedSiderealRFIMask`</span>

<span class="sd">Container Base Classes</span>
<span class="sd">----------------------</span>
<span class="sd">- :py:class:`TODContainer`</span>
<span class="sd">- :py:class:`VisContainer`</span>
<span class="sd">- :py:class:`SampleVarianceContainer`</span>
<span class="sd">- :py:class:`FreqContainer`</span>
<span class="sd">- :py:class:`SiderealContainer`</span>
<span class="sd">- :py:class:`MContainer`</span>

<span class="sd">Helper Routines</span>
<span class="sd">---------------</span>
<span class="sd">These routines are designed to be replaced by other packages trying to insert</span>
<span class="sd">their own custom container types.</span>

<span class="sd">- :py:meth:`empty_timestream`</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassVar</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">caput</span><span class="w"> </span><span class="kn">import</span> <span class="n">memdata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">caput.containers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">COMPRESSION</span><span class="p">,</span>
    <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
    <span class="n">ContainerPrototype</span><span class="p">,</span>
    <span class="n">DataWeightContainer</span><span class="p">,</span>
    <span class="n">TableSpec</span><span class="p">,</span>
    <span class="n">tod</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cora.core.containers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CosmologyContainer</span><span class="p">,</span>
    <span class="n">HealpixContainer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cora.core.containers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Map</span> <span class="k">as</span> <span class="n">_CoraMap</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..util</span><span class="w"> </span><span class="kn">import</span> <span class="n">tools</span>


<div class="viewcode-block" id="TODContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.TODContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TODContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">,</span> <span class="n">tod</span><span class="o">.</span><span class="n">TOData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pipeline container for time ordered data.</span>

<span class="sd">    This works like a normal :class:`ContainerPrototype` container, with the added</span>
<span class="sd">    ability to be concatenated, and treated like a a :class:`tod.TOData`</span>
<span class="sd">    instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,)</span></div>



<div class="viewcode-block" id="VisBase">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBase</span><span class="p">(</span><span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A very basic class for visibility data.</span>

<span class="sd">    For better support for input/prod/stack structured data use `VisContainer`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;vis&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;vis_weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The visibility like dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;vis&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisContainer</span><span class="p">(</span><span class="n">VisBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A base container for holding a visibility dataset.</span>

<span class="sd">    This works like a :class:`ContainerPrototype` container, with the</span>
<span class="sd">    ability to create visibility specific axes, if they are not</span>
<span class="sd">    passed as a kwargs parameter.</span>

<span class="sd">    Additionally this container has visibility specific defined properties</span>
<span class="sd">    such as &#39;vis&#39;, &#39;weight&#39;, &#39;freq&#39;, &#39;input&#39;, &#39;prod&#39;, &#39;stack&#39;,</span>
<span class="sd">    &#39;prodstack&#39;, &#39;conjugate&#39;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axes_from : `caput.containers.ContainerPrototype`, optional</span>
<span class="sd">        Another container to copy axis definitions from. Must be supplied as</span>
<span class="sd">        keyword argument.</span>
<span class="sd">    attrs_from : `caput.containers.ContainerPrototype`, optional</span>
<span class="sd">        Another container to copy attributes from. Must be supplied as keyword</span>
<span class="sd">        argument. This applies to attributes in default datasets too.</span>
<span class="sd">    kwargs : dict</span>
<span class="sd">        Should contain entries for all other axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;prod&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Resolve product map</span>
        <span class="n">prod</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;prod&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;prod&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">]</span>

        <span class="c1"># Resolve input map</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;input&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

        <span class="c1"># Resolve stack map</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;stack&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;stack&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">):</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span>

        <span class="c1"># Automatically construct product map from inputs if not given</span>
        <span class="k">if</span> <span class="n">prod</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nfeed</span> <span class="o">=</span> <span class="n">inputs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">fi</span><span class="p">,</span> <span class="n">fj</span><span class="p">]</span> <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfeed</span><span class="p">)</span> <span class="k">for</span> <span class="n">fj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">nfeed</span><span class="p">)]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">stack</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;u4&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;conjugate&quot;</span><span class="p">,</span> <span class="s2">&quot;u1&quot;</span><span class="p">)])</span>
            <span class="n">stack</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prod</span><span class="p">))</span>
            <span class="n">stack</span><span class="p">[</span><span class="s2">&quot;conjugate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stack</span>

        <span class="c1"># Call initializer from `ContainerPrototype`</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># `axes_from` can be provided via the `copy_from` argument, so</span>
        <span class="c1"># need to update kwargs to account</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;axes_from&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;copy_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;copy_from&quot;</span><span class="p">)</span>

        <span class="n">reverse_map_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Create reverse map</span>
        <span class="k">if</span> <span class="s2">&quot;reverse_map_stack&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1"># If axis is an integer, turn into an arange as a default definition</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;reverse_map_stack&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">reverse_map_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;reverse_map_stack&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reverse_map_stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;reverse_map_stack&quot;</span><span class="p">]</span>
        <span class="c1"># If not set in the arguments copy from another object if set</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;stack&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reverse_map</span><span class="p">):</span>
            <span class="n">reverse_map_stack</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reverse_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span>

        <span class="c1"># Set the reverse_map[&#39;stack&#39;] if we have a definition,</span>
        <span class="c1"># otherwise do NOT throw an error, errors are thrown in</span>
        <span class="c1"># classes that actually need a reverse stack</span>
        <span class="k">if</span> <span class="n">reverse_map_stack</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_reverse_map</span><span class="p">(</span><span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="n">reverse_map_stack</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The correlated inputs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All the pairwise products that are represented in the data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The stacks definition as an index (and conjugation) of a member product.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prodstack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A pair of input indices representative of those in the stack.</span>

<span class="sd">        Note, these are correctly conjugated on return, and so calculations</span>
<span class="sd">        of the baseline and polarisation can be done without additionally</span>
<span class="sd">        looking up the stack conjugation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stacked</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">][:][</span><span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">][</span><span class="s2">&quot;prod&quot;</span><span class="p">]]</span>

        <span class="n">prodmap</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">conj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="s2">&quot;conjugate&quot;</span><span class="p">]</span>
        <span class="n">prodmap</span><span class="p">[</span><span class="s2">&quot;input_a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">conj</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;input_b&quot;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;input_a&quot;</span><span class="p">])</span>
        <span class="n">prodmap</span><span class="p">[</span><span class="s2">&quot;input_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">conj</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;input_a&quot;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;input_b&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">prodmap</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_stacked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the data has been stacked or not.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span></div>



<div class="viewcode-block" id="SampleVarianceContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SampleVarianceContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SampleVarianceContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base container for holding the sample variance over observations.</span>

<span class="sd">    This works like :class:`ContainerPrototype` but provides additional capabilities</span>
<span class="sd">    for containers that may be used to hold the sample mean and variance over</span>
<span class="sd">    complex-valued observations.  These capabilities include automatic definition</span>
<span class="sd">    of the component axis, properties for accessing standard datasets, properties</span>
<span class="sd">    that rotate the sample variance into common bases, and a `sample_weight` property</span>
<span class="sd">    that provides an equivalent to the `weight` dataset that is determined from the</span>
<span class="sd">    sample variance over observations.</span>

<span class="sd">    Subclasses must include a `sample_variance` and `nsample` dataset</span>
<span class="sd">    in there `_dataset_spec` dictionary.  They must also specify a</span>
<span class="sd">    `_mean` property that returns the dataset containing the mean over observations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Set component axis to default real-imaginary basis if not already provided</span>
        <span class="k">if</span> <span class="s2">&quot;component&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[(</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;real&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">)],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;component_a&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;U8&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;component_b&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;U8&quot;</span><span class="p">)],</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the component axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience access to the sample variance dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        C: np.ndarray[ncomponent, ...]</span>
<span class="sd">            The variance over the dimension that was stacked</span>
<span class="sd">            (e.g., sidereal days, holographic observations)</span>
<span class="sd">            in the default real-imaginary basis. The array is packed</span>
<span class="sd">            into upper-triangle format such that the component axis</span>
<span class="sd">            contains [(&#39;real&#39;, &#39;real&#39;), (&#39;real&#39;, &#39;imag&#39;), (&#39;imag&#39;, &#39;imag&#39;)].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;sample_variance&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;sample_variance&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;sample_variance&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_variance_iq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate the sample variance to the in-phase/quadrature basis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        C: np.ndarray[ncomponent, ...]</span>
<span class="sd">            The `sample_variance` dataset in the in-phase/quadrature basis,</span>
<span class="sd">            packed into upper triangle format such that the component axis</span>
<span class="sd">            contains [(&#39;I&#39;, &#39;I&#39;), (&#39;I&#39;, &#39;Q&#39;), (&#39;Q&#39;, &#39;Q&#39;)].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_variance</span><span class="p">[:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="c1"># Construct rotation coefficients from average vis angle</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">[:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="c1"># Rotate the covariance matrix from real-imag to in-phase/quadrature</span>
        <span class="n">Cphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">Cphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cs</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ss</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Cphi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cs</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">cc</span> <span class="o">-</span> <span class="n">ss</span><span class="p">)</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cs</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Cphi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cs</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cc</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Cphi</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_variance_amp_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the amplitude/phase covariance.</span>

<span class="sd">        This interpretation is only valid if the fractional</span>
<span class="sd">        variations in the amplitude and phase are small.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        C: np.ndarray[ncomponent, ...]</span>
<span class="sd">            The observed amplitude/phase covariance matrix, packed</span>
<span class="sd">            into upper triangle format such that the component axis</span>
<span class="sd">            contains [(&#39;amp&#39;, &#39;amp&#39;), (&#39;amp&#39;, &#39;phase&#39;), (&#39;phase&#39;, &#39;phase&#39;)].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Rotate to in-phase/quadrature basis and then</span>
        <span class="c1"># normalize by squared amplitude to convert to</span>
        <span class="c1"># fractional units (amplitude) and radians (phase).</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_variance_iq</span> <span class="o">*</span> <span class="n">tools</span><span class="o">.</span><span class="n">invert_no_zero</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean</span><span class="p">[:][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nsample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nsample dataset if it exists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nsample&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;nsample&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;nsample&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate a weight from the sample variance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        weight: np.ndarray[...]</span>
<span class="sd">            The trace of the `sample_variance` dataset is used</span>
<span class="sd">            as an estimate of the total variance and divided by the</span>
<span class="sd">            `nsample` dataset to yield the uncertainty on the mean.</span>
<span class="sd">            The inverse of this quantity is returned, and can be compared</span>
<span class="sd">            directly to the `weight` dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_variance</span><span class="p">[:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="n">nsample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsample</span><span class="p">[:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nsample</span> <span class="o">*</span> <span class="n">tools</span><span class="o">.</span><span class="n">invert_no_zero</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>



<div class="viewcode-block" id="FreqContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FreqContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FreqContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pipeline container for data with a frequency axis.</span>

<span class="sd">    This works like a normal :class:`ContainerPrototype` container, but already has a freq</span>
<span class="sd">    axis defined, and specific properties for dealing with frequencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">,)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The physical frequency associated with each entry of the time axis.</span>

<span class="sd">        By convention this property should return the frequency in MHz at the centre</span>
<span class="sd">        of each of frequency channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">][:][</span><span class="s2">&quot;centre&quot;</span><span class="p">]</span>
        <span class="c1"># Need to check for both types as different numpy versions return</span>
        <span class="c1"># different exceptions.</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">][:]</span></div>



<div class="viewcode-block" id="SiderealContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pipeline container for data with an RA axis.</span>

<span class="sd">    This works like a normal :class:`ContainerPrototype` container, but already has an RA</span>
<span class="sd">    axis defined, and specific properties for dealing with this axis.</span>

<span class="sd">    Note that Right Ascension is a fairly ambiguous term. What is typically meant</span>
<span class="sd">    here is the Local Stellar Angle, which is the transiting RA in CIRS coordinates.</span>
<span class="sd">    This is similar to J2000/ICRS with the minimal amount of coordinate rotation to</span>
<span class="sd">    account for the polar axis precession.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ra : array or int, optional</span>
<span class="sd">        Either the explicit locations of samples of the RA axis, or if passed an</span>
<span class="sd">        integer interpret this as a number of samples dividing the full sidereal day</span>
<span class="sd">        and create an axis accordingly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Allow the passing of a number of samples for the RA axis</span>
        <span class="k">if</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ra</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The RA in degrees associated with each sample of the RA axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">][:]</span></div>



<div class="viewcode-block" id="MContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.MContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for holding m-mode type data.</span>

<span class="sd">    Note this container will have an `msign` axis even though not all m-mode based</span>
<span class="sd">    data needs one. As always this is not an issue, datasets that don&#39;t need it are</span>
<span class="sd">    not required to list it in their `axes` list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mmax : integer, optional</span>
<span class="sd">        Largest m to be held.</span>
<span class="sd">    oddra : bool, optional</span>
<span class="sd">        Does this MContainer come from an underlying odd number of RA points. This</span>
<span class="sd">        determines if the largest negative m is filled or not (it is for odd=True, not</span>
<span class="sd">        for odd=False). Default is odd=False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;msign&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mmax</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">oddra</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="c1"># Set up axes from passed arguments</span>
        <span class="k">if</span> <span class="n">mmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mmax</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Ensure the sign axis is set correctly</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;msign&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">])</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Set oddra, prioritising an explicit keyword argument over anything else</span>
        <span class="k">if</span> <span class="n">oddra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;oddra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oddra</span>
        <span class="k">elif</span> <span class="s2">&quot;oddra&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;oddra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mmax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The maximum m stored.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">oddra</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this represents an odd or even number of RA points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;oddra&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="Map">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.Map">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">_CoraMap</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for holding multi-frequency sky maps.</span>

<span class="sd">    The maps are packed in format `[freq, pol, pixel]` where the polarisations</span>
<span class="sd">    are Stokes I, Q, U and V, and the pixel dimension stores a Healpix map.</span>

<span class="sd">    This is just an extension of the `Map` class in `cora` with a modified</span>
<span class="sd">    frequency index map.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nside : int</span>
<span class="sd">        The nside of the Healpix maps.</span>
<span class="sd">    polarisation : bool, optional</span>
<span class="sd">        If `True` all Stokes parameters are stored, if `False` only Stokes I is</span>
<span class="sd">        stored.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="SiderealStream">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealStream">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealStream</span><span class="p">(</span>
    <span class="n">FreqContainer</span><span class="p">,</span> <span class="n">VisContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">SampleVarianceContainer</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a visibility dataset in sidereal time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ra : int</span>
<span class="sd">        The number of points to divide the RA axis up into.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;weight_dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;vis_weight&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;input_flags&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;sample_variance&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;nsample&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;effective_ra&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gain dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input_flags dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;input_flags&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the vis dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;vis&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">effective_ra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the effective_ra dataset if it exists, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;effective_ra&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;effective_ra&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;effective_ra&#39; not initialised.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="SystemSensitivity">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SystemSensitivity">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SystemSensitivity</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding the total system sensitivity.</span>

<span class="sd">    This should be averaged/collapsed in the stack/prod axis</span>
<span class="sd">    to provide an overall summary of the system sensitivity.</span>
<span class="sd">    Two datasets are available: the measured noise from the</span>
<span class="sd">    visibility weights and the radiometric estimate of the</span>
<span class="sd">    noise from the autocorrelations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;measured&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;radiometer&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;frac_lost&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">measured</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the measured noise dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;measured&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radiometer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the radiometer estimate dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;radiometer&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weight dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">frac_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frac_lost dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;frac_lost&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="RFIMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.RFIMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RFIMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding an RFI mask for a timestream.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="RFIMaskByPol">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.RFIMaskByPol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RFIMaskByPol</span><span class="p">(</span><span class="n">RFIMask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a polarisation-dependent RFI mask as a function of time.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SiderealRFIMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealRFIMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealRFIMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding an RFI mask for a sidereal stream.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SiderealRFIMaskByPol">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealRFIMaskByPol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealRFIMaskByPol</span><span class="p">(</span><span class="n">SiderealRFIMask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a polarisation-dependent RFI mask as a function of RA.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="BaselineMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.BaselineMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaselineMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a baseline-dependent mask for a timestream.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>

<span class="sd">    Unlike RFIMask, this is distributed by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;stack&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The stack definition as an index (and conjugation) of a member product.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SiderealBaselineMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealBaselineMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealBaselineMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a baseline-dependent mask for a sidereal stream.</span>

<span class="sd">    The mask is `True` for contaminated samples that should be excluded, and</span>
<span class="sd">    `False` for clean samples.</span>

<span class="sd">    Unlike SiderealRFIMask, this is distributed by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;stack&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The stack definition as an index (and conjugation) of a member product.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="TimeStream">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.TimeStream">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TimeStream</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">VisContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for holding a visibility dataset in time.</span>

<span class="sd">    This should look similar enough to the CHIME</span>
<span class="sd">    :class:`~ch_util.andata.CorrData` container that they can be used</span>
<span class="sd">    interchangably in most cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;weight_dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;vis_weight&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;input_flags&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gain dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input_flags dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;input_flags&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="GridBeam">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.GridBeam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GridBeam</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generic container for representing a 2D beam on a rectangular grid.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;beam&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;celestial&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the quality dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gain dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the coordinates attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the theta axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">phi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the phi axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="HEALPixBeam">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HEALPixBeam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HEALPixBeam</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">HealpixContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for representing the spherical 2-d beam in a HEALPix grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ordering : {&quot;nested&quot;, &quot;ring&quot;}</span>
<span class="sd">        The HEALPix ordering scheme used for the beam map.</span>
<span class="sd">    coords : {&quot;celestial&quot;, &quot;galactic&quot;, &quot;telescope&quot;}</span>
<span class="sd">        The coordinate system that the beam map is defined on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pixel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;Et&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Ep&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">)],</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pixel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;Et&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Ep&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)],</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;beam&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">ordering</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ordering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordering</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ordering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ordering attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ordering&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the coordinate attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nsides of the map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pixel&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">12</span><span class="p">))</span></div>



<div class="viewcode-block" id="TrackBeam">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.TrackBeam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TrackBeam</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SampleVarianceContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a sequence of beam samples at arbitrary locations on the sphere.</span>

<span class="sd">    The axis of the beam samples is &#39;pix&#39;, defined by the numpy.dtype</span>
<span class="sd">    [(&#39;theta&#39;, np.float32), (&#39;phi&#39;, np.float32)].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pix&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pix&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;weight_dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pix&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;sample_variance&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pix&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;nsample&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;pix&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;beam&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">phi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coords</span><span class="o">=</span><span class="s2">&quot;celestial&quot;</span><span class="p">,</span>
        <span class="n">track_type</span><span class="o">=</span><span class="s2">&quot;drift&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">phi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;theta and phi axes must have same length: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>

            <span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="n">pix</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="n">pix</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">theta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">phi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Both theta and phi coordinates must be specified.&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;track_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gain dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the coordinates attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">track_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the track type attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;track_type&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pix axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pix&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="MModes">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.MModes">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MModes</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">VisContainer</span><span class="p">,</span> <span class="n">MContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding m-mode data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    vis : mpidataset.MPIArray</span>
<span class="sd">        Visibility array.</span>
<span class="sd">    weight : mpidataset.MPIArray</span>
<span class="sd">        Array of weights for each point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;msign&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;msign&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;stack&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="SVDModes">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SVDModes">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SVDModes</span><span class="p">(</span><span class="n">MContainer</span><span class="p">,</span> <span class="n">VisBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding SVD m-mode data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mmax : integer, optional</span>
<span class="sd">        Largest m to be held.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;nmode&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nmode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nmode dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;nmode&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="KLModes">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.KLModes">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KLModes</span><span class="p">(</span><span class="n">SVDModes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding KL filtered m-mode data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mmax : integer, optional</span>
<span class="sd">        Largest m to be held.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>



<div class="viewcode-block" id="VisGridStream">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisGridStream">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisGridStream</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">VisBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visibilities gridded into a 2D array.</span>

<span class="sd">    Only makes sense for an array which is a cartesian grid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;weight_dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;redundancy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">redundancy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the redundancy dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;redundancy&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;redundancy&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;redundancy&#39; not initialised.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="FilterFreqContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FilterFreqContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FilterFreqContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base container for data that has undergone filtering along the frequency axis.</span>

<span class="sd">    This container behaves like a standard `ContainerPrototype`, but is tailored for</span>
<span class="sd">    datasets where a frequency-domain filter has been applied. It defines a</span>
<span class="sd">    `freq_sum` axis by default and provides additional logic to manage mutually</span>
<span class="sd">    exclusive filter and frequency covariance datasets.</span>

<span class="sd">    Expected Datasets:</span>
<span class="sd">    ------------------</span>
<span class="sd">    - `filter` or `complex_filter`</span>
<span class="sd">      Real or complex filter applied in the frequency domain.</span>
<span class="sd">    - `freq_cov` or `complex_freq_cov`:</span>
<span class="sd">      Real or complex covariance matrix in the frequency domain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;freq_sum&quot;</span><span class="p">,)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;freq_sum&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;axes_from&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;axes_from&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Must provide </span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2"> or freq axis.&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="FilterFreqContainer.add_dataset">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FilterFreqContainer.add_dataset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure that multiple filters and covariances are not created.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">and</span> <span class="s2">&quot;complex_filter&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Requesting creation of real-valued filter but &quot;</span>
                <span class="s2">&quot;complex filter already exists.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;complex_filter&quot;</span> <span class="ow">and</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Requesting creation of complex-valued filter but &quot;</span>
                <span class="s2">&quot;real filter already exists.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;freq_cov&quot;</span> <span class="ow">and</span> <span class="s2">&quot;complex_freq_cov&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Requesting creation of real-valued freq_cov but &quot;</span>
                <span class="s2">&quot;complex_freq_cov already exists.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;complex_freq_cov&quot;</span> <span class="ow">and</span> <span class="s2">&quot;freq_cov&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Requesting creation of complex_freq_cov but &quot;</span>
                <span class="s2">&quot;real-valued freq_cov already exists.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the filter dataset, if available.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;complex_filter&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;complex_filter&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;filter&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the freq_cov dataset, if available.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;freq_cov&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;freq_cov&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;complex_freq_cov&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;complex_freq_cov&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;freq_cov&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">swapped_freq_cov_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the axis names of the freq_cov dataset with freq &lt;--&gt; freq_sum.</span>

<span class="sd">        This is useful for broadcasting the weight dataset when propagating the</span>
<span class="sd">        covariance matrix through linear operators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">swap</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">swap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cov</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]])</span></div>



<div class="viewcode-block" id="HybridVisStream">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HybridVisStream">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HybridVisStream</span><span class="p">(</span><span class="n">FilterFreqContainer</span><span class="p">,</span> <span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">VisBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visibilities beamformed only in the NS direction.</span>

<span class="sd">    This container has visibilities beam formed only in the NS direction to give a</span>
<span class="sd">    grid in elevation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;dirty_beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;elevation_vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;effective_ra&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;nsample&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;complex_filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;complex_freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

<div class="viewcode-block" id="HybridVisStream.add_dataset">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HybridVisStream.add_dataset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override base class to deal with elevation dependent vis weight.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;vis_weight&quot;</span> <span class="ow">and</span> <span class="s2">&quot;elevation_vis_weight&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Requesting creation of elevation-independent weights but &quot;</span>
                <span class="s2">&quot;elevation-dependent weights already exist.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;elevation_vis_weight&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;vis_weight&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Requesting creation of elevation-dependent weights but &quot;</span>
                    <span class="s2">&quot;elevation-independent weights already exist.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Make this the default weight dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;elevation_vis_weight&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dirty_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Not useful at this stage, but it&#39;s needed to propagate onward.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;dirty_beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">effective_ra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the effective_ra dataset if it exists, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;effective_ra&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;effective_ra&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;effective_ra&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nsample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nsample dataset if it exists, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;nsample&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;nsample&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;nsample&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the polarisation index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the east-west baseline index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;ew&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="HybridVisMModes">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HybridVisMModes">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HybridVisMModes</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">MContainer</span><span class="p">,</span> <span class="n">VisBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visibilities beamformed in the NS direction and m-mode transformed in RA.</span>

<span class="sd">    This container has visibilities beam formed only in the NS direction to give a</span>
<span class="sd">    grid in elevation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;msign&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;vis_weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;msign&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="RingMap">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.RingMap">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RingMap</span><span class="p">(</span>
    <span class="n">FilterFreqContainer</span><span class="p">,</span> <span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for holding multifrequency ring maps.</span>

<span class="sd">    The maps are packed in format `[freq, pol, ra, EW beam, el]` where</span>
<span class="sd">    the polarisations are Stokes I, Q, U and V.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nside : int</span>
<span class="sd">        The nside of the Healpix maps.</span>
<span class="sd">    polarisation : bool, optional</span>
<span class="sd">        If `True` all Stokes parameters are stored, if `False` only Stokes I is</span>
<span class="sd">        stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;beam&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;weight_dataset&quot;</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;dirty_beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;dirty_beam_power&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;rms&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;complex_filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;complex_freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">el</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the el axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;el&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the map dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;map&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the rms dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;rms&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dirty_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dirty_beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;dirty_beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dirty_beam_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dirty_beam_power dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;dirty_beam_power&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="RingMapMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.RingMapMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RingMapMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask bad ringmap pixels.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="RingMapTaper">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.RingMapTaper">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RingMapTaper</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a smooth transition from good to bad ringmap pixels.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;taper&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">taper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;taper&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map weight to taper so that it can easily be updated with masks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;taper&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FreqNoiseModel">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FreqNoiseModel">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FreqNoiseModel</span><span class="p">(</span><span class="n">FilterFreqContainer</span><span class="p">,</span> <span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container storing Cholesky factors of frequency-frequency noise covariance.</span>

<span class="sd">    This container is intended for generating noise realizations in visibility space</span>
<span class="sd">    that include the desired correlations as a function of freq and el.  This is</span>
<span class="sd">    typically used to populate a VisGridStream container with synthetic noise having</span>
<span class="sd">    a specific spectral structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;redundancy&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;complex_freq_cov&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_sum&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">redundancy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the redundancy dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;redundancy&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weight dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="GainDataBase">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.GainDataBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GainDataBase</span><span class="p">(</span><span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container interface for gain-like data.</span>

<span class="sd">    To support the previous behaviour of gain type data the weight dataset is optional,</span>
<span class="sd">    and returns None if it is not present.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;gain&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">memdata</span><span class="o">.</span><span class="n">MemDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gain dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">memdata</span><span class="o">.</span><span class="n">MemDataset</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The weights for each data point.</span>

<span class="sd">        Returns None is no weight dataset exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="CommonModeGainData">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.CommonModeGainData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CommonModeGainData</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">,</span> <span class="n">GainDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding gain data common to all inputs.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="CommonModeSiderealGainData">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.CommonModeSiderealGainData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CommonModeSiderealGainData</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">GainDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding sidereal gain data common to all inputs.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="GainData">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.GainData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GainData</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">,</span> <span class="n">GainDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding gain data.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;update_id&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;&lt;U64&quot;</span><span class="p">),</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the update id dataset if it exists.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;update_id&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SiderealGainData">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SiderealGainData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SiderealGainData</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">GainDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding sidereal gain data.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="StaticGainData">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.StaticGainData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StaticGainData</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">GainDataBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parallel container for holding static gain data (i.e. non time varying).&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelayCutoff">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelayCutoff">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelayCutoff</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a delay cutoff.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cutoff&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the cutoff dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;cutoff&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">el</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the el axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;el&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelayContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelayContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelayContainer</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container with a delay axis.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The delay axis in microseconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;delay&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelaySpectrum">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelaySpectrum">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelaySpectrum</span><span class="p">(</span><span class="n">DelayContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a delay power spectrum.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A note about definitions: for a dataset with a frequency axis, the corresponding</span>
<span class="sd">    delay spectrum is the result of Fourier transforming in frequency, while the delay</span>
<span class="sd">    power spectrum is obtained by taking the squared magnitude of each element of the</span>
<span class="sd">    delay spectrum, and then usually averaging over some other axis. Our unfortunate</span>
<span class="sd">    convention is to store a delay power spectrum in a `DelaySpectrum` container, and</span>
<span class="sd">    store a delay spectrum in a :py:class:`~draco.core.containers.DelayTransform`</span>
<span class="sd">    container.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;spectrum_samples&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;spectrum_mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">weight_boost</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;weight_boost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_boost</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight_boost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weight boost factor.</span>

<span class="sd">        If set, this factor was used to set the assumed noise when computing the</span>
<span class="sd">        spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;weight_boost&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frequency axis of the input data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelayTransform">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelayTransform">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelayTransform</span><span class="p">(</span><span class="n">DelayContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a delay spectrum.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    See the docstring for :py:class:`~draco.core.containers.DelaySpectrum` for a</span>
<span class="sd">    description of the difference between `DelayTransform` and `DelaySpectrum`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;spectrum_mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;sample&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight_boost</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;weight_boost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_boost</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight_boost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weight boost factor.</span>

<span class="sd">        If set, this factor was used to set the assumed noise when computing the</span>
<span class="sd">        spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;weight_boost&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frequency axis of the input data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelayTransformOperator">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelayTransformOperator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelayTransformOperator</span><span class="p">(</span><span class="n">DelayContainer</span><span class="p">,</span> <span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wiener filter that transforms each pixel from frequency to delay.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the filter dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="Fourier3DContainer">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.Fourier3DContainer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Fourier3DContainer</span><span class="p">(</span><span class="n">CosmologyContainer</span><span class="p">,</span> <span class="n">DelayContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A base container with Fourier axes, (pol,delay,u,v).&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;kx&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ky&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;kpara&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;uv_mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the kx axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;kx&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ky</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ky axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;ky&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kpara</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the k_parallel axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;kpara&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uv_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the uv-domain mask.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;uv_mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the redshift attrs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;redshift&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">freq_center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the central frequency attrs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;freq_center&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SpatialDelayCube">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SpatialDelayCube">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SpatialDelayCube</span><span class="p">(</span><span class="n">Fourier3DContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a data in (pol,delays,u,v) domain.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vis&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spatial data cube.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;vis&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="PowerSpectrum3D">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.PowerSpectrum3D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PowerSpectrum3D</span><span class="p">(</span><span class="n">Fourier3DContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a 3D power spectrum.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 3D power spectrum.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ps_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the power spectrum normalizaiton attrs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;ps_norm&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="PowerSpectrum2D">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.PowerSpectrum2D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PowerSpectrum2D</span><span class="p">(</span><span class="n">CosmologyContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a 2D cylindrically averaged  power spectrum.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;uv_dist&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;uv_dist&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;uv_dist&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;neff&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;uv_dist&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;uv_dist&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;kpara&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;kperp&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uv_dist&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 2D power spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 2D weight dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">neff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the effective number of modes dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;neff&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 2D signal window dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kpara</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the k_parallel axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;kpara&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">kperp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the kprep axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;kperp&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delay_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the delay cutoff value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;delay_cut&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="PowerSpectrum1D">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.PowerSpectrum1D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PowerSpectrum1D</span><span class="p">(</span><span class="n">CosmologyContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a 1D power spectrum.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;samp_var&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;neff&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;k1D&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 1D power spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">samp_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 1D power spectrum error dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;samp_var&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 1D power spectrum var dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">neff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the 1D power spectrum var dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;neff&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k1D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the k1D dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;k1D&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="WaveletSpectrum">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.WaveletSpectrum">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WaveletSpectrum</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">DelayContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a wavelet power spectrum.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;spectrum&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The wavelet spectrum.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DelayCrossSpectrum">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.DelayCrossSpectrum">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DelayCrossSpectrum</span><span class="p">(</span><span class="n">DelaySpectrum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a delay cross power spectra.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;spectrum_samples&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;delay&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;baseline&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="Powerspectrum2D">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.Powerspectrum2D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Powerspectrum2D</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a 2D cartesian power spectrum.</span>

<span class="sd">    Generally you should set the standard attributes `z_start` and `z_end` with</span>
<span class="sd">    the redshift range included in the power spectrum estimate, and the `type`</span>
<span class="sd">    attribute with a description of the estimator type. Suggested valued for</span>
<span class="sd">    `type` are:</span>

<span class="sd">    `unwindowed`</span>
<span class="sd">        The standard unbiased quadratic estimator.</span>

<span class="sd">    `minimum_variance`</span>
<span class="sd">        The minimum variance, but highly correlated, estimator. Just a rescaled</span>
<span class="sd">        version of the q-estimator.</span>

<span class="sd">    `uncorrelated`</span>
<span class="sd">        The uncorrelated estimator using the root of the Fisher matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kpar_edges, kperp_edges : np.ndarray</span>
<span class="sd">        Array of the power spectrum bin boundaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;kperp&quot;</span><span class="p">,</span> <span class="s2">&quot;kpar&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;powerspectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;kperp&quot;</span><span class="p">,</span> <span class="s2">&quot;kpar&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;C_inv&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;kperp&quot;</span><span class="p">,</span> <span class="s2">&quot;kpar&quot;</span><span class="p">,</span> <span class="s2">&quot;kperp&quot;</span><span class="p">,</span> <span class="s2">&quot;kpar&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kperp_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kpar_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Construct the kperp axis from the bin edges</span>
        <span class="k">if</span> <span class="n">kperp_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">centre</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">kperp_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">kperp_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">kperp_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">kperp_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;kperp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span>
                <span class="p">[</span><span class="n">centre</span><span class="p">,</span> <span class="n">width</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;centre&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="c1"># Construct the kpar axis from the bin edges</span>
        <span class="k">if</span> <span class="n">kpar_edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">centre</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">kpar_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">kpar_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">kpar_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">kpar_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;kpar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span>
                <span class="p">[</span><span class="n">centre</span><span class="p">,</span> <span class="n">width</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;centre&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">powerspectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the powerspectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;powerspectrum&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">C_inv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the C inverse dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;C_inv&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SVDSpectrum">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SVDSpectrum">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SVDSpectrum</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for an m-mode SVD spectrum.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;singularvalue&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;spectrum&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;singularvalue&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the spectrum dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FrequencyStack">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FrequencyStack">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FrequencyStack</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a frequency stack.</span>

<span class="sd">    In general used to hold the product of `draco.analysis.SourceStack`</span>
<span class="sd">    The stacked signal of frequency slices of the data in the direction</span>
<span class="sd">    of sources of interest.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;stack&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the stack dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FrequencyStackByPol">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FrequencyStackByPol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FrequencyStackByPol</span><span class="p">(</span><span class="n">FrequencyStack</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a frequency stack split by polarisation.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="MockFrequencyStack">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.MockFrequencyStack">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockFrequencyStack</span><span class="p">(</span><span class="n">FrequencyStack</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for holding a frequency stack for multiple mock catalogs.</span>

<span class="sd">    Adds a `mock` axis as the first dimension of each dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;mock&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mock&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mock&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="MockFrequencyStackByPol">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.MockFrequencyStackByPol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockFrequencyStackByPol</span><span class="p">(</span><span class="n">FrequencyStackByPol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for holding a frequency stack split by pol for multiple mock catalogs.</span>

<span class="sd">    Adds a `mock` axis as the first dimension of each dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;mock&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mock&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mock&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="Stack3D">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.Stack3D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Stack3D</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for a 3D frequency stack.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_ra&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_dec&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_ra&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_dec&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_ra&quot;</span><span class="p">,</span> <span class="s2">&quot;delta_dec&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;stack&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the stack dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="SourceCatalog">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SourceCatalog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SourceCatalog</span><span class="p">(</span><span class="n">TableSpec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A basic container for holding astronomical source catalogs.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The `ra` and `dec` coordinates should be ICRS.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_table_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;object_id&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="SpectroscopicCatalog">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.SpectroscopicCatalog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SpectroscopicCatalog</span><span class="p">(</span><span class="n">SourceCatalog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for spectroscopic catalogs.&quot;&quot;&quot;</span>

    <span class="n">_table_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;redshift&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;z_error&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]],</span>
            <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s2">&quot;object_id&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="FormedBeam">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FormedBeam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FormedBeam</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">DataWeightContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for formed beams.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)]),</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;redshift&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;z_error&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)]),</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">_data_dset_name</span> <span class="o">=</span> <span class="s2">&quot;beam&quot;</span>
    <span class="n">_weight_dset_name</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;beam&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the position dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the redshift dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;redshift&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;redshift&quot;</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Dataset &#39;redshift&#39; not initialised.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frequency axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the object id axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pol axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FormedBeamHA">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FormedBeamHA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FormedBeamHA</span><span class="p">(</span><span class="n">FormedBeam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for formed beams.</span>

<span class="sd">    These have not been collapsed in the hour angle (HA) axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ha&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;object_ha&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the hour angle dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;object_ha&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FormedBeamHAEW">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FormedBeamHAEW">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FormedBeamHAEW</span><span class="p">(</span><span class="n">FormedBeamHA</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for formed beams constructed from a HybridVisStream.</span>

<span class="sd">    These have not been collapsed along the hour angle (ha) or</span>
<span class="sd">    east west baseline (ew) axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ew&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;object_ha&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ew index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;ew&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FitFormedBeam">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FitFormedBeam">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FitFormedBeam</span><span class="p">(</span><span class="n">FormedBeam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for formed beams fit to a primary beam model versus hour angle.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight_background&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;corr_background_beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the background dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">weight_background</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weight_background dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;weight_background&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">corr_background_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the corr_background_beam dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;corr_background_beam&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FitFormedBeamEW">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FitFormedBeamEW">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FitFormedBeamEW</span><span class="p">(</span><span class="n">FitFormedBeam</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for formed beams fit to a primary beam model versus hour angle.</span>

<span class="sd">    These have not been collapsed along the east west baseline (ew) axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ew&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;weight_background&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;corr_background_beam&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ew index map.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;ew&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FormedBeamMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FormedBeamMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FormedBeamMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask bad formed beams.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="FormedBeamHAMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.FormedBeamHAMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FormedBeamHAMask</span><span class="p">(</span><span class="n">FormedBeamMask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mask bad formed beams as a function of hour angle.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ha&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ha&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span></div>



<div class="viewcode-block" id="empty_timestream">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.empty_timestream">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">empty_timestream</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new timestream container.</span>

<span class="sd">    This indirect call exists so it can be replaced to return custom timestream</span>
<span class="sd">    types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kwargs : optional</span>
<span class="sd">        Arguments to pass to the timestream constructor.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ts : TimeStream</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TimeStream</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="LocalizedRFIMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.LocalizedRFIMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LocalizedRFIMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">TODContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for an RFI mask for each freq, el, and time sample.</span>

<span class="sd">    The data frac_rfi stores information about the proportion of subdata</span>
<span class="sd">    that detected RFI, which is used to generate the mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;el&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;frac_rfi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">frac_rfi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frac_rfi dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;frac_rfi&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">el</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the el axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;el&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="LocalizedSiderealRFIMask">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.LocalizedSiderealRFIMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LocalizedSiderealRFIMask</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">,</span> <span class="n">SiderealContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for an RFI mask for each freq, ra, and el sample.</span>

<span class="sd">    The data frac_rfi stores information about the proportion of subdata</span>
<span class="sd">    that detected RFI, which is used to generate the mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;el&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;frac_rfi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;el&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s2">&quot;truncate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the mask dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">frac_rfi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the frac_rfi dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;frac_rfi&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">el</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the el axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;el&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassWindow">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassWindow">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassWindow</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for bandpass gains and their window estimated by running bandpass HyFoReS on hybrid beam-formed visibilities.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="c1"># TODO: check if np.complex128 is required</span>
    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;window&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the window dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassCompensate">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassCompensate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassCompensate</span><span class="p">(</span><span class="n">FreqContainer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for window-compensated bandpass gains.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pol&quot;</span><span class="p">,)</span>

    <span class="c1"># TODO: redefine the second axis for sval</span>
    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;comp_bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;sval&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">comp_bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the comp_bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;comp_bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the sval dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;sval&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassWindowBaseline">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassWindowBaseline">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassWindowBaseline</span><span class="p">(</span><span class="n">VisBandpassWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for bandpass gains and their window estimated by running bandpass HyFoReS on hybrid beam-formed visibilities.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ew&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;window&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the window dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassCompensateBaseline">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassCompensateBaseline">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassCompensateBaseline</span><span class="p">(</span><span class="n">VisBandpassCompensate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for window-compensated bandpass gains.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ew&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;comp_bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;sval&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">comp_bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the comp_bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;comp_bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the sval dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;sval&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassWindowBaselineRA">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassWindowBaselineRA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassWindowBaselineRA</span><span class="p">(</span><span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">VisBandpassWindowBaseline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for bandpass gains and their window estimated by running bandpass HyFoReS on hybrid beam-formed visibilities.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;window&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the window dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="VisBandpassCompensateBaselineRA">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.VisBandpassCompensateBaselineRA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">VisBandpassCompensateBaselineRA</span><span class="p">(</span><span class="n">SiderealContainer</span><span class="p">,</span> <span class="n">VisBandpassCompensateBaseline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for window-compensated bandpass gains.&quot;&quot;&quot;</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;comp_bandpass&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="s2">&quot;freq&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;rank&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pol&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;ra&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed_axis&quot;</span><span class="p">:</span> <span class="s2">&quot;ra&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
            <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="n">COMPRESSION</span><span class="p">,</span>
            <span class="s2">&quot;compression_opts&quot;</span><span class="p">:</span> <span class="n">COMPRESSION_OPTS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">comp_bandpass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the comp_bandpass dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;comp_bandpass&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the sval dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">]</span></div>



<div class="viewcode-block" id="HorizonLimit">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HorizonLimit">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HorizonLimit</span><span class="p">(</span><span class="n">ContainerPrototype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container holding the altitude of the horizon as a function of azimuth.&quot;&quot;&quot;</span>

    <span class="n">_axes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;azimuth&quot;</span><span class="p">,)</span>

    <span class="n">_dataset_spec</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;altitude&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;azimuth&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="s2">&quot;initialise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;distributed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

<div class="viewcode-block" id="HorizonLimit.get_horizon_limit">
<a class="viewcode-back" href="../../../_autosummary/draco.core.containers.html#draco.core.containers.HorizonLimit.get_horizon_limit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_horizon_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">az</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate the horizon altitude at a given azimuth.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        az : float or ndarray</span>
<span class="sd">            Azimuth angle in degrees at which to evaluate the horizon limit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        alt : float or ndarray</span>
<span class="sd">            Interpolated horizon altitude(s) in degrees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">360.0</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">azimuth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the index map containing the azimuth angle (in degrees).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">[</span><span class="s2">&quot;azimuth&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dataset containing the altitude (in degrees).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s2">&quot;altitude&quot;</span><span class="p">]</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Richard Shaw.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>